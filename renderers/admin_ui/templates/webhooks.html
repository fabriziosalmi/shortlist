<!-- Webhook Management Section -->
<div id="webhook-section" class="section-card">
    <h2>ðŸ”” Webhook Management</h2>
    
    <!-- Add New Webhook -->
    <div class="card mb-4">
        <div class="card-body">
            <h3 class="card-title">Add New Webhook</h3>
            <form id="webhook-form" class="mt-3">
                <div class="mb-3">
                    <label for="webhook-url" class="form-label">Webhook URL</label>
                    <input type="url" class="form-control" id="webhook-url" required
                           placeholder="https://example.com/webhook">
                </div>
                
                <div class="mb-3">
                    <label for="webhook-event" class="form-label">Event Type</label>
                    <select class="form-select" id="webhook-event" required>
                        <option value="shortlist.updated">Shortlist Updated</option>
                        <option value="node.down">Node Down (Coming Soon)</option>
                        <option value="node.up">Node Up (Coming Soon)</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="webhook-description" class="form-label">Description (Optional)</label>
                    <input type="text" class="form-control" id="webhook-description"
                           placeholder="E.g., Slack notifications for updates">
                </div>
                
                <button type="submit" class="btn btn-primary">Add Webhook</button>
            </form>
        </div>
    </div>
    
    <!-- Active Webhooks -->
    <div class="card">
        <div class="card-body">
            <h3 class="card-title">Active Webhooks</h3>
            <div id="webhooks-list" class="mt-3">
                <!-- Webhooks will be dynamically inserted here -->
            </div>
        </div>
    </div>
</div>

<!-- Webhook List Template -->
<template id="webhook-template">
    <div class="webhook-item card mb-3">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h5 class="card-title"></h5>
                    <p class="card-text text-muted"></p>
                    <div class="badge bg-primary mb-2"></div>
                </div>
                <button class="btn btn-danger btn-sm delete-webhook">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </div>
</template>

<!-- Webhook JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadWebhooks();
    
    // Setup form submission
    document.getElementById('webhook-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const url = document.getElementById('webhook-url').value;
        const event = document.getElementById('webhook-event').value;
        const description = document.getElementById('webhook-description').value;
        
        try {
            const response = await fetch('/ui/webhooks', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url, event, description })
            });
            
            if (!response.ok) throw new Error('Failed to add webhook');
            
            showNotification('success', 'Webhook added successfully');
            loadWebhooks();
            this.reset();
            
        } catch (error) {
            showNotification('error', 'Failed to add webhook: ' + error.message);
        }
    });
});

async function loadWebhooks() {
    try {
        const response = await fetch('/ui/webhooks');
        if (!response.ok) throw new Error('Failed to load webhooks');
        
        const webhooks = await response.json();
        displayWebhooks(webhooks);
        
    } catch (error) {
        showNotification('error', 'Failed to load webhooks: ' + error.message);
    }
}

function displayWebhooks(webhooks) {
    const container = document.getElementById('webhooks-list');
    const template = document.getElementById('webhook-template');
    
    container.innerHTML = '';
    
    if (webhooks.length === 0) {
        container.innerHTML = '<p class="text-muted">No webhooks configured</p>';
        return;
    }
    
    webhooks.forEach(webhook => {
        const element = template.content.cloneNode(true);
        const item = element.querySelector('.webhook-item');
        
        item.querySelector('h5').textContent = new URL(webhook.url).host;
        item.querySelector('p').textContent = webhook.description || 'No description';
        item.querySelector('.badge').textContent = webhook.event;
        
        // Setup delete button
        const deleteBtn = item.querySelector('.delete-webhook');
        deleteBtn.onclick = () => deleteWebhook(webhook.id);
        
        container.appendChild(element);
    });
}

async function deleteWebhook(id) {
    if (!confirm('Are you sure you want to delete this webhook?')) return;
    
    try {
        const response = await fetch(`/ui/webhooks/${id}`, {
            method: 'DELETE'
        });
        
        if (!response.ok) throw new Error('Failed to delete webhook');
        
        showNotification('success', 'Webhook deleted successfully');
        loadWebhooks();
        
    } catch (error) {
        showNotification('error', 'Failed to delete webhook: ' + error.message);
    }
}
</script>